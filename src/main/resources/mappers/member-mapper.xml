<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">

	<!-- 자체 회원가입 insert -->
	<insert id="join" parameterType="mvo">
		insert into member(m_id, m_pw,
		m_phone, m_gender, m_birthday, m_nick, m_regdate, m_status,
		m_fail_count, m_out_date, m_login_type, m_token, m_t_time, m_image)
		values(#{m_id}, #{m_pw}, #{m_phone}, #{m_gender}, #{m_birthday},
		#{m_nick}, sysdate(), 1,
		#{m_fail_count}, #{m_out_date}, 1, #{m_token},
		#{m_t_time}, #{m_image})
	</insert>

	<!-- 아이디 중복 검사 -->
	<select id="idChk" parameterType="String" resultType="int">
		select
		count(*) from member where m_id = #{m_id}
	</select>

	<!-- 회원 검색 -->
	<select id="selectListBySearchVO" parameterType="msvo"
		resultType="mvo">
		select * from member
		<where>
			<if test="m_id != null">
				m_id = #{m_id}
			</if>
			<if test="m_phone != null">
				and m_phone = #{m_phone}
			</if>
			<if test="m_gender != null">
				and m_gender = #{m_gender}
			</if>
			<if test="m_birthday != null">
				and m_birthday = #{m_birthday}
			</if>
			<if test="m_nick != null">
				and m_nick = #{m_nick}
			</if>
			<if test="m_status != null">
				and m_status = #{m_status}
			</if>
			<!-- m_login_type이 2이상이면 소셜가입 계정이 검색됨 -->
			<if test="m_login_type != null">
				and m_login_type <![CDATA[>=]]>
				#{m_login_type}
			</if>
			<if test="like_id != null">
				and m_id Like '%#{like_id}%'
			</if>
			<if test="like_phone != null">
				and m_phone Like '%#{like_phone}%'
			</if>
			<if test="like_birthday != null">
				and m_birthday Like '%#{like_birthday}%'
			</if>
			<if test="like_nick != null">
				and m_nick Like '%#{like_nick}%'
			</if>
			<if test="regdate_start != null">
				and m_regdate <![CDATA[>=]]>
				#{regdate_start}
			</if>
			<if test="regdate_end != null">
				and m_regdate <![CDATA[<]]>
				#{regdate_end}
			</if>
			<if test="out_date_end != null">
				and m_out_date <![CDATA[<]]>
				#{out_date_end}
			</if>
			<if test="member_lock != null">
				and m_fail_count <![CDATA[>=]]>
				5
			</if>
		</where>
	</select>
</mapper>