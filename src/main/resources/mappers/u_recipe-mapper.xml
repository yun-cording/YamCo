<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="u_recipe">
	<!-- 일주일 조회수 기준 상위 30개 가져오기 -->
	<select id="rankListRecipe7Days" resultType="urmvo">
		select * from
		u_recipe_metadata
		order by hit_7day desc LIMIT 30
	</select>
	
	<!-- 한달 조회수 기준 상위 30개 가져오기 -->
	<select id="rankListRecipe1Month" resultType="urmvo">
		select * from
		u_recipe_metadata
		order by hit_1mon desc LIMIT 30
	</select>
	
	<!-- 검색어로 결과 rcp_idx 가져오기 -->
	<select id="recipeSearch" parameterType="Map" resultType="urmvo">
		select * from u_recipe_metadata where u_rcp_title like CONCAT('%',#{search},'%') or u_rcp_category like CONCAT('%',#{search},'%') or u_rcp_ing like CONCAT('%',#{search},'%')
		order by
		<if test="order == 0 or order==null"> u_rcp_hit </if>
		<if test="order == 1"> avg_grade </if>
		desc
	</select>
	
	<!-- rcp_idx로 metadata 가져와서 검색결과 띄우기 -->
	<select id="metaData" parameterType="String" resultType="urmvo">
		select * from
		u_recipe_metadata
		where rcp_idx=#{rcp_idx}
	</select>
	
	<!-- rcp_idx에 해당 하는 레시피 조회수 1 상승 -->
	<update id="hitUp" parameterType="String">
		update u_recipe set u_rcp_hit = u_rcp_hit + 1 where rcp_idx = #{rcp_idx}
	</update>
	
	<!-- 레시피 글쓰기 -->
	<insert id="write" parameterType="urvo">
	insert into u_recipe(m_idx , u_rcp_title
	<if test="u_rcp_comment != null">,u_rcp_comment</if>
	<if test="u_rcp_category != null">,u_rcp_category</if>
	<if test="u_rcp_ing != null">,u_rcp_ing</if>
	<if test="u_rcp_main != null">,u_rcp_main</if>
	<if test="u_rcp_level != null">,u_rcp_level</if>
	<if test="u_rcp_keyword != null">,u_rcp_keyword</if>
	<if test="u_rcp_tip != null">,u_rcp_tip</if>
	,u_rcp_blind ,m_nick,u_rcp_status
	<if test="u_rcp_hit != null">,u_rcp_hit</if>
	<if test="u_rcp_ctype != null">,u_rcp_ctype</if>
	,u_rcp_time	,u_rcp_img)
	values(	#{m_idx} , #{u_rcp_title}
	<if test="u_rcp_comment != null">,#{u_rcp_comment}</if>
	<if test="u_rcp_category != null">,#{u_rcp_category}</if>
	<if test="u_rcp_ing != null">,#{u_rcp_ing}</if>
	<if test="u_rcp_main != null">,#{u_rcp_main}</if>
	<if test="u_rcp_level != null">,#{u_rcp_level}</if>
	<if test="u_rcp_keyword != null">,#{u_rcp_keyword}</if>
	<if test="u_rcp_tip != null">,#{u_rcp_tip}</if>
	,#{u_rcp_blind}	,#{m_nick} ,#{u_rcp_status}
	<if test="u_rcp_hit != null">,#{u_rcp_hit}</if>
	<if test="u_rcp_ctype != null">,#{u_rcp_ctype}</if>
	, sysdate()	,#{u_rcp_img})
	</insert>
</mapper>